{
  "type": "object",
  "properties": {

    "doc_type": { "type": "string", "pattern": "^person$" },

    "version": { "type": "string", "format": "semver" },
    
    "referenceNumber": { "type": "integer" },
    
    "otherIds": { "type": "object" },
    
    "surname": { "type": "string" },
    "otherNames": { "type": "string" },

    "occupation": { "type": "string" },

    "age": { "type": "number" },
    "gender": { "enum": ["m", "f"] },
    "status": { "enum": ["alive", "dead"] },

    "classification": { "enum": ["case", "contact"] },
    "subClassification": { "type": "string" },
    
    "phoneNumber": { "type": "string" },
    "phoneOwner": { "type": "string" },

    "address": { "$ref": "#/definitions/address" },

    "createdDate": { "type": "string", "format": "date-time" },
    "modifiedDate": { "type": "string", "format": "date-time" },

    "changeLog": { "$ref": "#/definitions/changeLog" },
    
    "case": { "$ref": "#/definitions/case" },

    "labResults": { "type": "array", "items": { "$ref": "#/definitions/labResult" } },

    "contact": { "$ref": "#/definitions/contact" },

    "calls": { "type": "array", "items": { "$ref": "#/definitions/call" } },

    "actions": { "type": "array" },

    "comments": { "type": "array", "items": {
        "type": "object",
        "properties": {
          "date": { "type": "string", "format": "date-time" },
          "text": { "type": "string" }
        }
      }
    },
    
    "sources": { "type": "array", "items": {"type": "object"} }
  },
  
  "definitions": {

    "address": { "type": "object", "additionalProperties": {
      "type": ["string", "integer"]
    }},

    
    "changeLog": { "type": "array", "items": {
      "type": "object",
      "properties": {
        "rev": { "type": "string" },
        "timestamp": { "type": "integer" },
        "user": { "type": "string" }
      }
    }},

    "labResult": {"type": "object", "properties": {
        
        "minRequirementStatus":  { "enum": ["accepted", "pending", "rejected"] },

        "collectedBy": { 
          "type": "object", "properties": {
            "persons": { "type": "array", "items": { "type": "object" }},
            "facilityName": { "type": "string" }
          }
        },

        "labName": {"type": "string"},
        "caseId": {"type": "string"},
        "sampleId": {"type": "string"},
        "sampleType": {"type": "string"},
        "sampledDate": { "type": "string", "format": "date-time" },
        "testedDate": { "type": "string", "format": "date-time" },
        "initialSymptomOnsetDate": { "type": "string", "format": "date-time" },
        "statusAtSampleCollection": { "enum": ["alive", "dead"] },
        "addressOnset": { "$ref": "#/definitions/address" },
        "collectionType":  { "enum": ["initial", "repeat"] },
        "importedDate": { "type": "string", "format": "date-time" },
        "result": { "enum": ["positive", "negative", "indeterminate"] },
        "ctValue": { "type": "string" },
        "cdcValue": { "type": "string" },
        "ms2Control": { "type": "string" }
      }
    },



    "contact": { "type": "object", "properties": {
      "sourceCases": { "type": "array", "items": {
        "type": "object",
        "properties": {
          "surname": { "type": "string" },
          "otherNames": { "type": "string" },
          "lastContactDate": { "type": "string", "format": "date-time" }
        }
      }},
      
      "followUps": { "type": "array", "items": {
        "type": "object",
        "properties": {
          "dateOfVisit": { "type": "string", "format": "date-time" },
          "isSymptomatic": { "type": "boolean" },
          "symptoms": { "$ref": "#/definitions/symptoms" },
          "geoInfo": { "type": "object", "properties": {
            "coords": { "type": "object", "properties": {
              "longitude": { "type": "number" },
              "latitude": { "type": "number" }
            }}
          }}
        }
      }}
    }},

    "case": {"type": "object", "properties": {
      "onsetDate": { "type": "string", "format": "date-time" },
      "interviewer": { "type": "object", "properties": {
        "name": {"type": "string"}
      }},
      "hadContactWith": {
        "deadPerson": { "type": "boolean" },
        "sickPerson": { "type": "boolean" },
        "healthWorker": { "type": "boolean" },
        "homeQuarantine": { "type": "boolean" }
      },
      "symptoms": { "$ref": "#/definitions/symptoms" }
    }},

    "call": { "type": "object", "properties": {
      "createdBy": { "type": "string" },
      "createdDate": { "type": "string", "format": "date-time" },
      "name": { "type": "string" },
      "address": { "$ref": "#/definitions/address" },
      "phoneNumber": { "type": "string" },
      "otherPhoneNumber": { "type": "string" },
      "callNature": { "enum": ["death",
                               "suspect",
                               "sick",
                               "health information",
                               "quarantine",
                               "security threat",
                               "prank call",
                               "other"]},
      "callDetails": { "type": "string" },
      "isFollowUp": { "type": "boolean" }
    }},
    
    "symptoms": {"type": "object", "properties": {
      "fever": { "type": "boolean" },
      "vomiting": { "type": "boolean" },
      "diarrhea": { "type": "boolean" },
      "weakness": { "type": "boolean" },
      "muscleOrJointPain": { "type": "boolean" },
      "bleeding": { "type": "boolean" },
      "rash": { "type": "boolean" },
      "abdominalPain": { "type": "boolean" },
      "difficultySwallowing": { "type": "boolean" },
      "headache": { "type": "boolean" },
      "other": { "type": "string" }
    }}
  },


  "required": [
    "doc_type",
    "version",
    "surname",
    "classification"
  ]
}
