{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Person",
  "description": "TODO",
  "type": "object",
  "properties": {

    "doc_type": { "type": "string", "pattern": "^person$" },

    "version": { "type": "string", "format": "semver" },

    "referenceNumber": { "type": "integer" },

    "otherIds": { "type": "object" },

    "surname": { "type": "string", "minLength": 1 },
    "otherNames": { "type": "string" },

    "occupation": { "type": "string" },

    "age": { "type": "object", "properties": {
      "years": { "type": "number" },
      "months": { "type": "number" }
    }},
    "gender": { "enum": ["m", "f"] },
    "status": { "enum": ["alive", "dead"] },

    "currentLocation": { "type": "string" },

    "phoneNumber": { "type": "string" },
    "phoneOwner": { "type": "string" },

    "address": { "$ref": "#/definitions/address" },

    "createdDate": { "type": "string", "format": "date-time" },
    "modifiedDate": { "type": "string", "format": "date-time" },

    "changeLog": { "$ref": "#/definitions/changeLog" },

    "case": { "$ref": "#/definitions/case" },

    "contact": { "$ref": "#/definitions/contact" },

    "calls": { "type": "array", "items": { "$ref": "#/definitions/call" } },

    "actions": { "type": "array" },

    "comments": { "type": "array", "items": {
        "type": "object",
        "properties": {
          "date": { "type": "string", "format": "date-time" },
          "text": { "type": "string" }
        }
      }
    },

    "source": { "type": "object" }
  },

  "definitions": {

    "address": {
      "type": "object",
      "properties": {
        "adminDivision1": { "type": ["string", "number"] },
        "adminDivision2": { "type": ["string", "number"] },
        "adminDivision3": { "type": ["string", "number"] },
        "adminDivision4": { "type": ["string", "number"] },
        "address": { "type": "string" },
        "countryCode": {
          "type": "string",
          "pattern": "^(gn|ml|lr)$",
          "description": "country code following ISO_3166-1_alpha-2 in lowercase"
        }
      },
      "additionalProperties": false
    },


    "changeLog": { "type": "array", "items": {
      "type": "object",
      "properties": {
        "rev": { "type": "string" },
        "timestamp": { "type": "integer" },
        "user": { "type": "string" }
      }
    }},

    "contact": { "type": "object", "properties": {
      "status": { "enum": ["unknown", "active", "complete", "lost"] },
      "sourceCases": { "type": "array", "items": {
        "type": "object",
        "properties": {
          "surname": { "type": "string" },
          "otherNames": { "type": "string" },
          "lastContactDate": { "type": "string", "format": "date-time" }
        }
      }},

      "followUps": { "type": "array", "items": {
        "type": "object",
        "properties": {
          "dateOfVisit": { "type": "string", "format": "date-time" },
          "isSymptomatic": { "type": "boolean" },
          "symptoms": { "$ref": "#/definitions/symptoms" },
          "geoInfo": { "type": "object", "properties": {
            "coords": { "type": "object", "properties": {
              "longitude": { "type": "number" },
              "latitude": { "type": "number" }
            }}
          }}
        }
      }}
    },
    "required": ["status"]
    },

    "case": {"type": "object", "properties": {
      "status": { "enum": ["unknown", "suspect", "probable", "confirmed", "not a case"] },
      "onsetDate": { "type": "string", "format": "date-time" },
      "interviewer": { "type": "object", "properties": {
        "name": {"type": "string"}
      }},
      "hadContactWith": {
        "deadPerson": { "type": "boolean" },
        "sickPerson": { "type": "boolean" },
        "healthWorker": { "type": "boolean" },
        "homeQuarantine": { "type": "boolean" }
      },
      "symptoms": { "$ref": "#/definitions/symptoms" }
    },
     "required": ["onsetDate", "status"]
    },

    "call": { "type": "object", "properties": {
      "createdBy": { "type": "string" },
      "createdDate": { "type": "string", "format": "date-time" },
      "name": { "type": "string" },
      "address": { "$ref": "#/definitions/address" },
      "phoneNumber": { "type": "string" },
      "otherPhoneNumber": { "type": "string" },
      "callNature": { "enum": ["death",
                               "suspect",
                               "sick",
                               "health information",
                               "quarantine",
                               "security threat",
                               "prank call",
                               "other"]},
      "callDetails": { "type": "string" },
      "isFollowUp": { "type": "boolean" }
    }},

    "symptom": {"type": "object", "properties": {
      "name": { "enum": [
          "fever",
          "vomiting",
          "diarrhea",
          "weakness",
          "muscleOrJointPain",
          "bleeding",
          "rash",
          "abdominalPain",
          "difficultySwallowing",
          "headache",
          "nauseaVomiting",
          "lossOfAppetite",
          "intenseFatigue",
          "muscularPain",
          "articularPain",
          "thoracicPain",
          "difficultyBreathing",
          "cough",
          "soreThroat",
          "hiccup",
          "unexplainedBleedings"
        ]},
      "value": { "type": "boolean" }
    }},

    "symptoms": {"type": "object", "properties": {
      "temperature": { "type": "number"},
      "list": {  "type": "array", "items": { "anyOf": [{ "$ref": "#/definitions/symptom" }] }},
      "comments": { "type": "string" }
    },
      "required": ["list"]
    }
  },


  "required": [
    "doc_type",
    "version",
    "surname"
  ]
}
